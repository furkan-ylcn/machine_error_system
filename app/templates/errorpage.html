{% extends "base.html" %} 

{% block content %}
<div id="errorpage">
    <h2>Report Error for Machine {{ machine_number }}</h2>
    
    <div id="errorbuttons" style="margin-bottom: 20px;">
        <button onclick="selectError(1)">Error1</button>
        <button onclick="selectError(2)">Error2</button>
        <button onclick="selectError(3)">Error3</button>
        <button onclick="selectError(4)">Error4</button>
    </div>
    
    <div id="errortextarea">
        <textarea id="errorDescription" placeholder="Please enter the error description.." style="width: 100%; height: 100px; margin-bottom: 10px;"></textarea>
        <button onclick="submitError()">Submit Error Report</button>
    </div>
    
    <div id="message" style="margin-top: 10px;"></div>
</div>

<script>
let selectedErrorType = null;

function selectError(errorType) {
    selectedErrorType = errorType;
    const buttons = document.querySelectorAll('#errorbuttons button');
    buttons.forEach(btn => btn.style.backgroundColor = '');
    event.target.style.backgroundColor = '#4CAF50';
    event.target.style.color = 'white';
}

function submitError() {
    const errorDescription = document.getElementById('errorDescription').value;
    const messageDiv = document.getElementById('message');
    
    if (!selectedErrorType) {
        messageDiv.innerHTML = '<p style="color: red;">Please select an error type</p>';
        return;
    }
    
    if (!errorDescription.trim()) {
        messageDiv.innerHTML = '<p style="color: red;">Please enter error description</p>';
        return;
    }
    
    fetch('/submit-error', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            machine_number: {{ machine_number }},
            error_type: selectedErrorType,
            error_description: errorDescription
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            messageDiv.innerHTML = '<p style="color: green;">Error reported successfully!</p>';
            document.getElementById('errorDescription').value = '';
            selectedErrorType = null;
            const buttons = document.querySelectorAll('#errorbuttons button');
            buttons.forEach(btn => {
                btn.style.backgroundColor = '';
                btn.style.color = '';
            });
        } else {
            messageDiv.innerHTML = `<p style="color: red;">${data.message}</p>`;
        }
    })
    .catch(error => {
        messageDiv.innerHTML = `<p style="color: red;">Error: ${error}</p>`;
    });
}

document.getElementById('errorDescription').addEventListener('keydown', function(e) {
    if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
    }
});
</script>

<style>
#errorbuttons button {
    padding: 10px 20px;
    margin: 5px;
    border: 1px solid #ccc;
    background-color: #f8f9fa;
    cursor: pointer;
    border-radius: 4px;
}

#errorbuttons button:hover {
    background-color: #e9ecef;
}

#errortextarea button {
    padding: 10px 20px;
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

#errortextarea button:hover {
    background-color: #0056b3;
}
</style>
{% endblock %}